<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ate's Funeral Gallery</title>
    <style>
        /* CSS remains largely the same, added a loader style */
        * {box-sizing: border-box}
        body {font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin:0; background-color: #1a1a1a; color: white;}
        
        .slideshow-container {
            max-width: 900px;
            position: relative;
            margin: 20px auto;
            overflow: hidden;
            border-radius: 12px;
            background-color: #000;
            aspect-ratio: 16 / 9; /* Keeps a consistent shape while loading */
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .mySlides { display: none; width: 100%; height: 100%; }
        
        img {
            width: 100%;
            height: 100%;
            object-fit: contain; 
        }

        .prev, .next {
            cursor: pointer;
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            padding: 20px;
            color: white;
            font-weight: bold;
            font-size: 24px;
            background-color: rgba(0,0,0,0.4);
            transition: 0.3s;
            z-index: 10;
            text-decoration: none;
        }
        .next { right: 0; border-radius: 5px 0 0 5px; }
        .prev { left: 0; border-radius: 0 5px 5px 0; }
        .prev:hover, .next:hover { background-color: rgba(255,255,255,0.2); }

        .numbertext {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.6);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 14px;
        }

        .play-pause-btn {
            cursor: pointer;
            background-color: rgba(255,255,255,0.2);
            color: white;
            padding: 20px;
            border: none;
            border-radius: 50%;
            font-size: 30px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 11;
            opacity: 0;
            transition: 0.3s;
            backdrop-filter: blur(5px);
        }
        .slideshow-container:hover .play-pause-btn { opacity: 1; }
    </style>
</head>
<body>

<h2 style="text-align:center;">Ate's Gallery</h2>

<div style="text-align:center; margin-bottom: 20px;">
     <label>Transition Speed: </label>
     <select id="speed" onchange="changeSpeed()" style="padding: 5px; border-radius: 5px;">
         <option value="2000">2s</option>
         <option value="3000" selected>3s</option>
         <option value="5000">5s</option>
     </select>
</div>

<div class="slideshow-container" id="slides-target">
    <div id="loading-msg">Scanning Gallery...</div>
    <button id="playPauseBtn" class="play-pause-btn" onclick="togglePlayPause()">||</button>
    <a class="prev" onclick="plusSlides(-1)">&#10094;</a>
    <a class="next" onclick="plusSlides(1)">&#10095;</a>
</div>

<script>
    let slideIndex = 1;
    let timer; 
    let currentSpeed = 3000; 
    let isPlaying = true; 
    const MAX_IMAGES = 650; 

    function initGallery() {
        const target = document.getElementById('slides-target');
        const fragment = document.createDocumentFragment();

        for (let i = 1; i <= MAX_IMAGES; i++) {
            const slideDiv = document.createElement('div');
            slideDiv.className = "mySlides";
            
            // This format handles 001.jpg. 
            // NOTE: If your files are .JPG (caps), change it here!
            const fileName = i.toString().padStart(3, '0') + ".jpg";

            slideDiv.innerHTML = `
                <div class="numbertext">${i} / ${MAX_IMAGES}</div>
                <img src="${fileName}" 
                     onerror="removeInvalidSlide(this)" 
                     onload="markAsReady(this)">`;
            
            fragment.appendChild(slideDiv);
        }
        
        // Add all at once to the DOM (hidden)
        target.appendChild(fragment);

        // Start the show after a short delay to let browser probe files
        setTimeout(() => {
            document.getElementById('loading-msg').style.display = 'none';
            showSlides(slideIndex);
            startTimer();
        }, 1000);
    }

    function removeInvalidSlide(imgElement) {
        // If image fails, remove the whole slide container
        imgElement.parentElement.remove();
    }

    function markAsReady(imgElement) {
        // Just a helper to ensure the div is valid
        imgElement.parentElement.classList.add('ready');
    }

    function showSlides(n) {
        let slides = document.getElementsByClassName("mySlides");
        if (slides.length === 0) return;

        if (n > slides.length) {slideIndex = 1}
        if (n < 1) {slideIndex = slides.length}

        for (let i = 0; i < slides.length; i++) {
            slides[i].style.display = "none";
        }
        slides[slideIndex-1].style.display = "block";
    }

    function startTimer() {
        if (isPlaying && !timer) { 
            timer = setInterval(() => plusSlides(1), currentSpeed);
        }
    }

    function togglePlayPause() {
        const btn = document.getElementById("playPauseBtn");
        if (isPlaying) {
            clearInterval(timer);
            timer = null;
            btn.innerHTML = "&#9658;"; 
            isPlaying = false;
        } else {
            isPlaying = true;
            btn.innerHTML = "||"; 
            startTimer();
        }
    }

    function plusSlides(n) {
        showSlides(slideIndex += n);
        if (isPlaying) {
            clearInterval(timer);
            timer = null;
            startTimer();
        }
    }

    function changeSpeed() {
        currentSpeed = parseInt(document.getElementById("speed").value);
        if (isPlaying) {
            clearInterval(timer);
            timer = null;
            startTimer();
        }
    }

    // Run on boot
    initGallery();
</script>

</body>
</html>